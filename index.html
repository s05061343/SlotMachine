<!DOCTYPE html>
<html>
    <head>
        <title>Slot Machine</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="google-site-verification" content="d58Et_hG0KrLc6xKv03J8U5NA6jqak0kCFxBaz7Y1MM" />

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.dataTables.min.css" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css"
        />
        <link rel="stylesheet" href="css/app.css" />
    </head>

    <body>
        <div class="container bg-light bg-gradient">
            <div class="row">
                <div class="col-12">
                    <select name="" id="selectGift"></select>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="slotwrapper" id="example"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <input type="text" class="form-control" id="endNum" value="7" />
                </div>
                <div class="col-6">
                    <button type="button" class="btn btn-success btn-sm" id="btn-example">Start Spin!</button>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <table id="table" class="table-hover table table-sm">
                        <thead>
                            <tr>
                                <th>獎項</th>
                                <th>部門</th>
                                <th>工號</th>
                                <th>姓名</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdn.datatables.net/2.1.8/js/dataTables.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-zh_tw.min.js"></script> -->
        <script src="js/slotmachine.js"></script>

        <script type="text/javascript">
            const excel_id = `1Mb0eTyfaG-QgGixSodslO8owErS1lf_2Wl5N5U4KSP0`
            const sheet0 = `員工名單`
            const sheet1 = `獎項`
            const api_key = `AIzaSyC1g_biEzb8sbgV7tg9pTisqcISljzok68`
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${excel_id}/values/${sheet0}?alt=json&key=${api_key}`
            const urlGift = `https://sheets.googleapis.com/v4/spreadsheets/${excel_id}/values/${sheet1}?alt=json&key=${api_key}`
            const arr = [0, 1, 2]
            var store, storeTable
            $.get(url, function (data) {
                arr.forEach((x) => {
                    const ul = $(`<ul class="shadow-sm"></ul>`)
                    store = data.values
                    data.values.forEach((x, index) => {
                        ul.append(
                            `<li>
                                ${x[0]}
                            </li>`
                        )
                    })

                    $(`#example`).append(ul)
                })

                const table = new DataTable('#table')
                storeTable = []

                $(`#endNum`).val(getRandomInt(store.length) + 1)
            })

            $.get(urlGift, function (data) {
                console.table(data.values)
                data.values.forEach((x, index) => {
                    $(`#selectGift`).append(`<option>${x[0]}</option>`)
                })

                // $(`#selectGift`).selectpicker()
            })

            $('#btn-example').click(function () {
                const num = $(`#endNum`).val()
                $('#example ul').playSpin({
                    stopSeq: 'leftToRight',
                    time: 500,
                    // easing: 'easeOutBack',
                    endNum: [num, num, num],
                    onEnd: function (num) {
                        // console.log(num)
                    },
                    onFinish: function (num) {
                        const data = store[num[0]]
                        console.log(data)
                        Swal.fire(`${data[0]}, ${data[1]}, ${data[2]}`)
                        const table = new DataTable('#table')

                        if (storeTable.find((x) => x[0] === data[0])) {
                            console.log(`重複!`)
                            Swal.fire('重複!')
                        } else {
                            storeTable.push(data)
                            table.row.add([$(`#selectGift`).val(), data[0], data[1], data[2]]).draw(false)
                        }

                        console.table(storeTable)

                        $(`#endNum`).val(getRandomInt(store.length) + 1)
                    },
                })
            })

            function getRandomInt(max) {
                return Math.floor(Math.random() * max)
            }
        </script>
    </body>
</html>
