<!DOCTYPE html>
<html>
    <head>
        <title>Slot Machine</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="google-site-verification" content="d58Et_hG0KrLc6xKv03J8U5NA6jqak0kCFxBaz7Y1MM" />

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
        />
        <link
            href="https://cdn.datatables.net/v/bs5/jszip-3.10.1/dt-2.1.8/af-2.7.0/b-3.1.2/b-colvis-3.1.2/b-html5-3.1.2/b-print-3.1.2/cr-2.0.4/date-1.5.4/fc-5.0.4/fh-4.0.1/kt-2.12.1/r-3.0.3/rg-1.5.1/rr-1.5.0/sc-2.4.3/sb-1.8.1/sp-2.3.3/sl-2.1.0/sr-1.4.1/datatables.min.css"
            rel="stylesheet"
        />
        <!-- <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css"
        /> -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/fontawesome.min.css"
            integrity="sha384-NvKbDTEnL+A8F/AA5Tc5kmMLSJHUO868P+lDtTpJIeQdGYaUIuLr4lVGOEA1OcMy"
            crossorigin="anonymous"
        />
        <link rel="stylesheet" href="css/app.css" />
    </head>

    <body>
        <div class="container px-5">
            <div class="row" style="height: 90dvh">
                <div class="col-12 d-flex flex-column justify-content-center align-items-center">
                    <div class="card shadow-sm bg-gold w-75 border-0">
                        <div class="card-body">
                            <div class="container">
                                <div class="row mb-3">
                                    <div class="col-12">
                                        <select name="" class="form-select form-select-lg" id="selectGift"></select>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="card shadow-sm p-0 border-0">
                                        <div class="card-body bg-red rounded p-0">
                                            <div class="slotwrapper" id="example"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <button type="button" class="btn metallic-button btn-lg w-100" id="btn-example">
                                            Start Spin!
                                        </button>
                                    </div>
                                    <div class="col-12 d-none">
                                        <input type="text" class="form-control" id="endNum" value="7" disabled />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <table id="table" class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>獎項</th>
                                        <th>部門</th>
                                        <th>工號</th>
                                        <th>姓名</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"
        ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
        <script src="https://cdn.datatables.net/v/bs5/jszip-3.10.1/dt-2.1.8/af-2.7.0/b-3.1.2/b-colvis-3.1.2/b-html5-3.1.2/b-print-3.1.2/cr-2.0.4/date-1.5.4/fc-5.0.4/fh-4.0.1/kt-2.12.1/r-3.0.3/rg-1.5.1/rr-1.5.0/sc-2.4.3/sb-1.8.1/sp-2.3.3/sl-2.1.0/sr-1.4.1/datatables.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script> -->
        <script src="./lib/fontawesome/js/all.js"></script>
        <script src="js/slotmachine.js"></script>

        <script type="text/javascript">
            const excel_id = `1Mb0eTyfaG-QgGixSodslO8owErS1lf_2Wl5N5U4KSP0`
            const sheet0 = `員工名單`
            const sheet1 = `獎項`
            const api_key = `AIzaSyC1g_biEzb8sbgV7tg9pTisqcISljzok68`
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${excel_id}/values/${sheet0}?alt=json&key=${api_key}`
            const urlGift = `https://sheets.googleapis.com/v4/spreadsheets/${excel_id}/values/${sheet1}?alt=json&key=${api_key}`
            const arr = [0, 1, 2]
            var store
            var storeTable = []

            $.get(url, function (data) {
                store = data.values
                console.table(store)
                arr.forEach((x) => {
                    const ul = $(`<ul></ul>`)

                    data.values.forEach((x, index) => {
                        ul.append(
                            `<li class="bg-dark bg-gradient shadow-sm rounded">
                                <h1>
                                    ${x[0]}
                                </h1>
                            </li>`)
                    })

                    $(`#example`).append(ul)
                })

                const table = new DataTable('#table', {
                    layout: {
                        topStart: {
                            buttons: ['csv', 'excel'],
                        },
                    },
                })
            })

            $.get(urlGift, function (data) {
                console.table(data.values)
                data.values.forEach((x, index) => {
                    $(`#selectGift`).append(`<option>${x[0]}</option>`)
                })
            })

            var temp
            $('#btn-example').click(function () {
                temp = []
                const num = getRandomInt(store.length)
                $(`#endNum`).val(num)
                $('#example ul').playSpin({
                    stopSeq: 'leftToRight',
                    time: 500,
                    // easing: 'easeOutBack',
                    endNum: [num, num, num],
                    onEnd: function (num) {
                        temp.push(num)
                        console.log(temp)
                    },
                    onFinish: function (num) {
                        console.log(num)
                        const data = store[temp[0] - 1]
                        const obj = [
                            $(`#selectGift`).val(),
                            data[0],
                            data[1],
                            data[2],
                            `<a index="${temp[0] - 1}" data-id="${data[0]}">
                                <i class="fa-solid fa-trash"></i>
                            </a>`,
                        ]
                        console.table(obj)
                        // Swal.fire(`${obj[0]} ${obj[1]}, ${obj[2]}, ${obj[3]}`)
                        Swal.fire({
                            title: `${obj[0]}`,
                            text: `${obj[0]} ${obj[1]}, ${obj[2]}, ${obj[3]}`,
                            // imageUrl: 'https://unsplash.it/400/200',
                            imageUrl: './img/main.png',
                            imageWidth: 240,
                            imageHeight: 240,
                            imageAlt: 'Custom image',
                        })

                        if (storeTable.find((x) => x[1] === obj[1])) {
                            Swal.fire('重複!')
                        } else {
                            storeTable.push(obj)
                            const table = new DataTable('#table')
                            table.row.add(obj).draw(false)
                        }
                    },
                })
            })

            $('#table').on('click', 'tbody tr td a', function () {
                const id = $(this).attr('data-id')
                const data = storeTable.find((x) => x[1] === id)
                const obj = $(this)
                Swal.fire({
                    title: '確定刪除?',
                    text: `${data[0]} ${data[1]}, ${data[2]} ${data[3]}`,
                    icon: 'question',
                    showConfirmButton: true,
                }).then(function (result) {
                    if (result.isConfirmed) {
                        const table = new DataTable('#table')
                        table.row(obj.parents('tr')).remove().draw()
                    }
                })
            })

            function getRandomInt(x) {
                return Math.floor(Math.random() * x) + 1
            }
        </script>
    </body>
</html>
